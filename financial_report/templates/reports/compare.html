<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø–µ—Ä—ñ–æ–¥—ñ–≤</title>
    <link rel="stylesheet" href="/static/compare.css">
</head>
<body>
    <div class="top-links">
        <a href="{% url 'main:home' %}">–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</a>
    </div>

    <h2>üîé –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø–µ—Ä—ñ–æ–¥—ñ–≤</h2>
    <form method="get" class="mb-4">
        <label for="start_date_1">–ü–æ—á–∞—Ç–æ–∫ –ø–µ—Ä—à–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É:</label>
        <input type="date" name="start_date_1" required>

        <label for="end_date_1">–ö—ñ–Ω–µ—Ü—å –ø–µ—Ä—à–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É:</label>
        <input type="date" name="end_date_1" required>

        <label for="start_date_2">–ü–æ—á–∞—Ç–æ–∫ –¥—Ä—É–≥–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É:</label>
        <input type="date" name="start_date_2" required>

        <label for="end_date_2">–ö—ñ–Ω–µ—Ü—å –¥—Ä—É–≥–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É:</label>
        <input type="date" name="end_date_2" required>

        <button type="submit">–ü–æ—Ä—ñ–≤–Ω—è—Ç–∏</button>
    </form>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <h3>üìä –ì—Ä–∞—Ñ—ñ–∫ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è</h3>
    <h3>üìä –ì—Ä–∞—Ñ—ñ–∫ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑–∞ –ø–µ—Ä—ñ–æ–¥ {{ start1 }} - {{ end1 }} —Ç–∞ {{ start2 }} - {{ end2 }}</h3>
    <canvas id="comparisonChart"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const period1Data = JSON.parse('{{ period1_report_json|escapejs }}');
        const period2Data = JSON.parse('{{ period2_report_json|escapejs }}');

        const period1Label = '{{ period1_label|escapejs }}';
        const period2Label = '{{ period2_label|escapejs }}';

        const ctx = document.getElementById('comparisonChart').getContext('2d');

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['–î–æ—Ö–æ–¥–∏', '–í–∏—Ç—Ä–∞—Ç–∏', '–¶—ñ–ª—ñ –≤–∏–∫–æ–Ω–∞–Ω–æ'],
                datasets: [
                    {
                        label: period1Label,  // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–µ—Ä—ñ–æ–¥ —á–∞—Å—É
                        data: [
                            period1Data.income.total_income,
                            period1Data.expenses.total_expense,
                            period1Data.goals.achieved
                        ],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: period2Label,  // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–µ—Ä—ñ–æ–¥ —á–∞—Å—É
                        data: [
                            period2Data.income.total_income,
                            period2Data.expenses.total_expense,
                            period2Data.goals.achieved
                        ],
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>
</html>